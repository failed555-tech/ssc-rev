<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Product Reviews</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }

  .review-box, .review {
    background: white;
    padding: 15px;
    max-width: 500px;
    margin-bottom: 15px;
    border-radius: 6px;
  }

  input, textarea, button {
    width: 100%;
    padding: 8px;
    margin-top: 8px;
    font-size: 14px;
  }

  .stars {
    display: flex;
    gap: 5px;
    font-size: 22px;
    cursor: pointer;
  }

  .star {
    color: #ccc;
  }

  .star.selected {
    color: gold;
  }

  .name {
    font-weight: bold;
  }

  .rating {
    color: gold;
    margin-bottom: 5px;
  }

  .date {
    font-size: 12px;
    color: gray;
  }
</style>
</head>

<body>

<h2>Product Reviews</h2>

<div class="review-box">
  <input id="name" placeholder="Your name">
  
  <div class="stars" id="starInput">
    <span class="star" data-value="1">â˜…</span>
    <span class="star" data-value="2">â˜…</span>
    <span class="star" data-value="3">â˜…</span>
    <span class="star" data-value="4">â˜…</span>
    <span class="star" data-value="5">â˜…</span>
  </div>

  <textarea id="review" placeholder="Your review"></textarea>
  <button onclick="submitReview()">Submit Review</button>
</div>

<div id="reviews"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore, collection, addDoc,
    query, where, orderBy, onSnapshot, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ðŸ”¹ CHANGE THIS PER PRODUCT
  const PRODUCT_ID = "product-123";

  const firebaseConfig = {
  apiKey: "AIzaSyBBHjVfayq5AEPssUW2KU02Hg2bGNRj0II",
  authDomain: "ssc-rev1.firebaseapp.com",
  projectId: "ssc-rev1",
  storageBucket: "ssc-rev1.firebasestorage.app",
  messagingSenderId: "303141057870",
  appId: "1:303141057870:web:8e6bf07f60670e914c9a1f",
  measurementId: "G-47PRCYE2T7"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const reviewsRef = collection(db, "reviews");

  let selectedRating = 0;

  // â­ Star selection
  document.querySelectorAll(".star").forEach(star => {
    star.addEventListener("click", () => {
      selectedRating = Number(star.dataset.value);
      document.querySelectorAll(".star").forEach(s =>
        s.classList.toggle("selected", Number(s.dataset.value) <= selectedRating)
      );
    });
  });

  // ðŸ“ Submit review
  window.submitReview = async function () {
    const name = document.getElementById("name").value.trim();
    const review = document.getElementById("review").value.trim();

    if (!name || !review || selectedRating === 0) {
      alert("Please complete all fields and select a rating");
      return;
    }

    await addDoc(reviewsRef, {
      name,
      review,
      rating: selectedRating,
      productId: PRODUCT_ID,
      createdAt: serverTimestamp()
    });

    document.getElementById("name").value = "";
    document.getElementById("review").value = "";
    selectedRating = 0;
    document.querySelectorAll(".star").forEach(s => s.classList.remove("selected"));
  };

  // ðŸ“¡ Load product-specific reviews
  const q = query(
    reviewsRef,
    where("productId", "==", PRODUCT_ID),
    orderBy("createdAt", "desc")
  );

  onSnapshot(q, snapshot => {
    const container = document.getElementById("reviews");
    container.innerHTML = "";

    snapshot.forEach(doc => {
      const d = doc.data();

      const stars = "â˜…".repeat(d.rating) + "â˜†".repeat(5 - d.rating);

      const div = document.createElement("div");
      div.className = "review";
      div.innerHTML = `
        <div class="name">${d.name}</div>
        <div class="rating">${stars}</div>
        <div>${d.review}</div>
        <div class="date">${d.createdAt?.toDate().toLocaleString() || ""}</div>
      `;
      container.appendChild(div);
    });
  });
</script>

</body>
</html>

