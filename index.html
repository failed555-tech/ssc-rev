<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Product Reviews</title>
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px; }
.review-box, .review {
  background:white; padding:15px; max-width:500px;
  margin-bottom:15px; border-radius:6px;
}
input, textarea, button, select { width:100%; padding:8px; margin-top:8px; }
.stars { display:flex; gap:5px; font-size:22px; cursor:pointer; }
.star { color:#ccc; }
.star.selected { color:gold; }
.name { font-weight:bold; }
.rating { color:gold; margin-bottom:5px; }
.date { font-size:12px; color:gray; }
</style>
</head>

<body>

<h2>Leave a Review</h2>

<div class="review-box">
  <select id="productSelect">
    <option value="product1">Product 1</option>
    <option value="product2">Product 2</option>
    <option value="product3">Product 3</option>
  </select>

  <input id="name" placeholder="Your name">
  
  <div class="stars" id="starInput">
    <span class="star" data-value="1">â˜…</span>
    <span class="star" data-value="2">â˜…</span>
    <span class="star" data-value="3">â˜…</span>
    <span class="star" data-value="4">â˜…</span>
    <span class="star" data-value="5">â˜…</span>
  </div>

  <textarea id="review" placeholder="Your review"></textarea>
  <button id="submitBtn">Submit Review</button>
</div>

<h2>Reviews</h2>
<div id="reviews"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  query, where, onSnapshot, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ðŸ”¹ Your Firebase config here
const firebaseConfig = {
  apiKey: "AIzaSyBBHjVfayq5AEPssUW2KU02Hg2bGNRj0II",
  authDomain: "ssc-rev1.firebaseapp.com",
  projectId: "ssc-rev1",
  storageBucket: "ssc-rev1.firebasestorage.app",
  messagingSenderId: "303141057870",
  appId: "1:303141057870:web:8e6bf07f60670e914c9a1f",
  measurementId: "G-47PRCYE2T7"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const reviewsRef = collection(db, "reviews");

let selectedRating = 0;
let currentProduct = document.getElementById("productSelect").value;

// â­ Star selection
document.querySelectorAll(".star").forEach(star => {
  star.addEventListener("click", () => {
    selectedRating = Number(star.dataset.value);
    document.querySelectorAll(".star").forEach(s =>
      s.classList.toggle("selected", Number(s.dataset.value) <= selectedRating)
    );
  });
});

// ðŸ”„ Handle product change
document.getElementById("productSelect").addEventListener("change", (e) => {
  currentProduct = e.target.value;
  loadReviews(currentProduct);
});

// ðŸ“ Submit review
document.getElementById("submitBtn").addEventListener("click", async () => {
  const name = document.getElementById("name").value.trim();
  const review = document.getElementById("review").value.trim();
  if (!name || !review || selectedRating === 0) {
    alert("Please fill out all fields and select a rating");
    return;
  }

  await addDoc(reviewsRef, {
    name,
    review,
    rating: selectedRating,
    productId: currentProduct,
    createdAt: serverTimestamp()
  });

  document.getElementById("name").value = "";
  document.getElementById("review").value = "";
  selectedRating = 0;
  document.querySelectorAll(".star").forEach(s => s.classList.remove("selected"));
});

// Function to load reviews for a specific product
let unsubscribe = null;
function loadReviews(product) {
  if (unsubscribe) unsubscribe(); // Stop previous listener

  const q = query(reviewsRef, where("productId", "==", product));
  unsubscribe = onSnapshot(q, snapshot => {
    const container = document.getElementById("reviews");
    container.innerHTML = "";

    snapshot.forEach(doc => {
      const data = doc.data();
      if (!data.createdAt) return; // Skip if timestamp not ready
      const stars = "â˜…".repeat(data.rating) + "â˜†".repeat(5 - data.rating);

      const div = document.createElement("div");
      div.className = "review";
      div.innerHTML = `
        <div class="name">${data.name}</div>
        <div class="rating">${stars}</div>
        <div>${data.review}</div>
        <div class="date">${data.createdAt.toDate().toLocaleString()}</div>
      `;
      container.appendChild(div);
    });
  });
}

// Load initial product reviews
loadReviews(currentProduct);
</script>

</body>
</html>
